# Abstract Sofar Api

Date: 2020-10-30

## Status

Accepted.

## Context
The Sofar API exposes many different data points that can be accessed as through the web api
and return JSON objects containing data. However, different data points are stored at different URLs,
not just variable GET parameters. For this reason, multiple requests need to be made to the server to retrieve all of
data of interest. We considered two approaches, using an internal list of all urls and looping
or having different subclasses for each request.


## Decision
We decided to have different subclasses for a few critical reasons.

* If 1 of n calls failed, there was no way to return partial data with the loop option
* It was hard to return different Java data objects because the class has only one Type parameter.
* If in some instances only a subset of the data was required, the entire 2-3 seconds would be used to make all of the calls.

For this reason we decided to create the abstract class `SofarApi` to handle
the bulk of the internet connection duties, while delegating responsibility to the sub classes to determine how to
parse the data and what type of object to return. The error handling is implemented in SofarApi because all of the error
objects are the same regardless of url. However, the method is not final and can be overridden if
the subclass so desires.

## Consequences
The SofarApi class handles most of the complex handling of the web request and error handling.
Two abstract methods must be overridden for the query to make sense and define the whole URL.
This simplifies the act of extending the Sofar Api functionality to add more variables in the future as required.

One complexity generated by this is the number of different data objects. For each subclass, there also must be a
corresponding data object that holds the data as parsed by Jackson.

In addition, because SofarApi is generic, the validity of data must be handled by the subclass.